<div class="main-container">
    <p-toast></p-toast>

    <header class="header">
        <div class="header-content">
            <div class="user-info">
                <span class="username">{{ username }}</span>
                <span class="group">{{ groupNumber }}</span>
            </div>
            <p-button
                    (onClick)="logout()"
                    icon="pi pi-sign-out"
                    label="Logout"
                    styleClass="expand-effect-btn btn-logout"
            ></p-button>
        </div>
    </header>

    <div class="content-wrapper">
        <div class="left-panel">
            <div class="upper-panel">
                <p-panel header="Parameters">
                    <div class="input-section">
                        <div class="slider-container">
                            <label>Coordinate X: {{ sliderX }}</label>
                            <p-slider
                                    (dblclick)="resetX()"
                                    [(ngModel)]="sliderX"
                                    [disabled]="loading"
                                    [max]="3"
                                    [min]="-5"
                                    [step]="0.01"
                            ></p-slider>
                        </div>

                        <div class="slider-container">
                            <label>Coordinate Y: {{ sliderY }}</label>
                            <p-slider
                                    (dblclick)="resetY()"
                                    [(ngModel)]="sliderY"
                                    [disabled]="loading"
                                    [max]="5"
                                    [min]="-3"
                                    [step]="0.01"
                            ></p-slider>
                        </div>

                        <div class="slider-container">
                            <label>Radius R: {{ r }}</label>
                            <p-slider
                                    (onChange)="onRChange()"
                                    (dblclick)="resetR()"
                                    [(ngModel)]="r"
                                    [disabled]="loading"
                                    [max]="3"
                                    [min]="-5"
                                    [step]="0.01"
                            ></p-slider>
                        </div>

                        <div class="button-group">
                            <p-button
                                    (onClick)="onSubmit()"
                                    [loading]="loading"
                                    icon="pi pi-check-circle"
                                    label="Submit"
                                    styleClass="expand-effect-btn btn-submit"
                            ></p-button>
                            <p-button
                                    (onClick)="clearPoints()"
                                    [disabled]="loading || points.length === 0"
                                    icon="pi pi-trash"
                                    label="Clear All"
                                    styleClass="expand-effect-btn btn-clear"
                            ></p-button>
                        </div>
                    </div>
                </p-panel>
            </div>

            <div class="lower-panel">
                <p-panel class="results-panel" header="Results">
                    <p-table
                            [paginator]="true"
                            [rows]="5"
                            [scrollable]="true"
                            [value]="points"
                            [totalRecords]="points.length"
                            styleClass="results-table"
                    >
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Hit</th>
                                <th>X</th>
                                <th>Y</th>
                                <th>R</th>
                                <th>Time (μs)</th>
                                <th>Timestamp</th>
                            </tr>
                        </ng-template>
                        <ng-template let-point pTemplate="body">
                            <tr>
                                <td>
                                    <span [class]="point.hit ? 'hit-true' : 'hit-false'">
                                      {{ point.hit ? '✓' : '✗' }}
                                    </span>
                                </td>
                                <td>{{ point.x }}</td>
                                <td>{{ point.y }}</td>
                                <td>{{ point.r }}</td>
                                <td>{{ point.calTime | number: '1.1-1'}}</td>
                                <td>{{ point.releaseTime | date: 'dd/MM HH:mm:ss' }}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6" style="text-align: center;">No points checked yet</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-panel>
            </div>
        </div>

        <div class="right-panel">
            <p-panel header="Illustration Graph">
                <div class="canvas-wrapper">
                    <canvas #canvas class="graph-canvas"></canvas>
                </div>
                <div class="canvas-info">
                    <label>Current X: {{ canvasX }}</label>
                    <label>Current Y: {{ canvasY }}</label>
                </div>
            </p-panel>
        </div>
    </div>
</div>